<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" href="css/leaflet.css">
    <link rel="stylesheet" href="css/L.Control.Locate.min.css">
    <link rel="stylesheet" href="css/qgis2web.css">
    <link rel="stylesheet" href="css/Control.OSMGeocoder.css">
    <style>
      html, body, #map {
          width: 100%;
          height: 100%;
          padding: 0;
          margin: 0;
      }
      .sf_hoods {
        stroke: rgb(220, 108, 20);
        stroke-width: 2;
        stroke-opacity: 0.15;
        fill: rgb(255, 255, 255, 0.01);
      }
      .sf_hoods_labels {
        color: rgb(220, 108, 20, 0.7);
        // text-align: center;
        font-size: 12px;
        font-style: bold;
        font-family: 'Myriad Set Pro', sans-serif;
        // left: -50%;
        /*transform:translateX(-50%);
        margin-left: -50% !important;*/
      }
      .leaflet-tooltip-left .label-parent {
        position: relative;
        left: 50%;
      }
      .leaflet-tooltip-right .label-parent {
        position: relative;
        left: -50%;
      }
      // .leaflet-tooltip-left { background-color: rgba(255,255,0,0.5);}
      // .leaflet-tooltip-right { background-color: rgba(22,200,255,0.5);}
    </style>
    <title></title>
</head>
<body>
    <div id="map">
    </div>

    <script src="js/qgis2web_expressions.js"></script>
    <script src="js/leaflet.js"></script>
    <script src="js/leaflet-svg-shape-markers.min.js"></script>
    <script src="js/L.Control.Locate.min.js"></script>
    <script src="js/leaflet.rotatedMarker.js"></script>
    <script src="js/leaflet.pattern.js"></script>
    <script src="js/leaflet-hash.js"></script>
    <script src="js/Autolinker.min.js"></script>
    <script src="js/rbush.min.js"></script>
    <script src="js/labelgun.min.js"></script>
    <script src="js/labels.js"></script>
    <script src="js/Control.OSMGeocoder.js"></script>
    <script src="data/Countylabels_0.js"></script>
    <script src="data/Peaks_1.js"></script>
    <script src="data/sf_hoods.js"></script>
    <script src="data/ca_rivers.js"></script>
    <script src="data/osm_calif_water.js"></script>

    <script>

    var m2px = 1;
    function newM2px() {
        var centerLatLng = map.getCenter();
        var pointC = map.latLngToContainerPoint(centerLatLng);
        var pointX = [pointC.x + 100, pointC.y];

        var latLngC = map.containerPointToLatLng(pointC);
        var latLngX = map.containerPointToLatLng(pointX);

        var distanceX = latLngC.distanceTo(latLngX)/100;

        reciprocal = 1 / distanceX;
        m2px = reciprocal;
    }

    function geoStyle(m) {
        return Math.ceil(m * m2px);
    }

    var highlightLayer;
    function highlightFeature(e) {
        highlightLayer = e.target;

        if (e.target.feature.geometry.type === 'LineString') {
          highlightLayer.setStyle({
            color: '#ddd',
          });
        } else {
          highlightLayer.setStyle({
            fillColor: '#fff',
            fillOpacity: 0.05,
            // color: "rgb(233,219,240)",
            weight: 3
          });
        }
        // highlightLayer.openPopup();
    }

    var map = L.map('map', {
        zoomControl:true, maxZoom:28, minZoom:1
    // }).fitBounds([[32,-124.5],[42,-114]]);
    // }).fitBounds([[37,-122],[40,-120]]);
    }).fitBounds([[37.6956,-122.5180], [37.8094,-122.4029]]);

    map.attributionControl.addAttribution('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a>');

    var hash = new L.Hash(map);
    L.control.locate({
        icon: 'fa fa-map-marker',
        setView: 'untilPanOrZoom',
        locateOptions: {
            maxZoom: 17
        }
    }).addTo(map);

    var bounds_group = new L.featureGroup([]);

    function setBounds() {
        map.setMaxBounds(map.getBounds());
    }



/*
BEGIN sf_hoods
*/

    function pop_sf_hoods(feature, layer) {
        layer.on({
            mouseout: function(e) {
                for (i in e.target._eventParents) {
                    e.target._eventParents[i].resetStyle(e.target);
                }
                if (typeof layer.closePopup == 'function') {
                    layer.closePopup();
                } else {
                    layer.eachLayer(function(feature){
                        feature.closePopup()
                    });
                }
            },
            mouseover: highlightFeature,
        });
        var popupContent = '<table>\
                <tr>\
                    <td>' + (feature.properties['name'] !== null ? Autolinker.link(String(feature.properties['name'])) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['link'] !== null ? Autolinker.link(String(feature.properties['link'])) : '') + '</td>\
                </tr>\
            </table>';
        layer.bindPopup(popupContent, {maxHeight: 400});
    }

    /*function style_sf_hoods2() {
        console.log("style_sf_hoods2");
        return {
            pane: 'pane_sf_hoods',
            color: "rgba(20, 210, 220, 0.5)", // not stroke, strokeColor
            fill: true,
            fillColor: 'rgba(253,253,243,0.05)',
            weight: 2,
        };
    }*/
    // map.createPane('pane_Peaks_1');
    map.createPane('pane_sf_hoods');
    map.getPane('pane_sf_hoods').style.zIndex = 404;
    map.getPane('pane_sf_hoods').style['mix-blend-mode'] = 'normal';
    // var layer_Peaks_1 = new L.geoJson(json_Peaks_1, {
    var layer_sf_hoods = new L.geoJson(sf_hoods, {
        attribution: '<a href=""></a>',
        pane: 'pane_sf_hoods',
        // onEachFeature: pop_sf_hoods,
        // style: style_sf_hoods2,
    });
    layer_sf_hoods.setStyle({'className': 'sf_hoods'});
    bounds_group.addLayer(layer_sf_hoods);
    map.addLayer(layer_sf_hoods);

/*
END sf_hoods
BEGIN Counties
*/

    function pop_Countylabels_0(feature, layer) {
        layer.on({
            mouseout: function(e) {
                for (i in e.target._eventParents) {
                    e.target._eventParents[i].resetStyle(e.target);
                }
                if (typeof layer.closePopup == 'function') {
                    layer.closePopup();
                } else {
                    layer.eachLayer(function(feature){
                        feature.closePopup()
                    });
                }
            },
            mouseover: highlightFeature,
        });

        /*
        var popupContent = '<table>\
                <tr>\
                    <th scope="row">NAME</th>\
                    <td>' + (feature.properties['NAME'] !== null ? Autolinker.link(String(feature.properties['NAME'])) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['label'] !== null ? Autolinker.link(String(feature.properties['label'])) : '') + '</td>\
                </tr>\
            </table>';
        layer.bindPopup(popupContent, {maxHeight: 400});*/
    }

    function style_Countylabels_0_0() {
        return {
            pane: 'pane_Countylabels_0',
            // stroke: false,
            color: "rgb(187,166,217)", // not stroke, strokeColor
            // strokeColor: 'rgba(253,0,0,1)',
            fill: true,
            // fillOpacity: 0.5,
            fillColor: 'rgba(253,253,243,0.05)',
            weight: 1, // not strokeWidth: 1,
        }
    }
    map.createPane('pane_Countylabels_0');
    map.getPane('pane_Countylabels_0').style.zIndex = 400;
    map.getPane('pane_Countylabels_0').style['mix-blend-mode'] = 'normal';
    var layer_Countylabels_0 = new L.geoJson(json_Countylabels_0, {
        attribution: '<a href=""></a>',
        pane: 'pane_Countylabels_0',
        onEachFeature: pop_Countylabels_0,
        style: style_Countylabels_0_0,
    });
    bounds_group.addLayer(layer_Countylabels_0);
    map.addLayer(layer_Countylabels_0);


/*
END Counties

BEGIN Peaks
*/

    function pop_Peaks_1(feature, layer) {
        layer.on({
            mouseout: function(e) {
                for (i in e.target._eventParents) {
                    e.target._eventParents[i].resetStyle(e.target);
                }
                if (typeof layer.closePopup == 'function') {
                    layer.closePopup();
                } else {
                    layer.eachLayer(function(feature){
                        feature.closePopup()
                    });
                }
            },
            mouseover: highlightFeature,
        });
        var popupContent = '<table>\
                <tr>\
                    <th scope="row">NAME</th>\
                    <td>' + (feature.properties['NAME'] !== null ? Autolinker.link(String(feature.properties['NAME'])) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['ELEV_FT'] !== null ? Autolinker.link(String(feature.properties['ELEV_FT'])) : '') + '</td>\
                </tr>\
                <tr>\
                    <td colspan="2">' + (feature.properties['label'] !== null ? Autolinker.link(String(feature.properties['label'])) : '') + '</td>\
                </tr>\
            </table>';
        layer.bindPopup(popupContent, {maxHeight: 400});
    }

    function style_Peaks_1_0() {
        return {
            pane: 'pane_Peaks_1',
            shape: 'triangle',
            radius: geoStyle(4.0),
            opacity: 1,
            color: 'rgba(68,68,68,1.0)',
            dashArray: '',
            lineCap: 'butt',
            lineJoin: 'miter',
            weight: geoStyle(1),
            fill: true,
            fillOpacity: 1,
            fillColor: 'rgba(204,204,204,1.0)',
        };
    }
    map.createPane('pane_Peaks_1');
    map.getPane('pane_Peaks_1').style.zIndex = 401;
    map.getPane('pane_Peaks_1').style['mix-blend-mode'] = 'normal';
    var layer_Peaks_1 = new L.geoJson(json_Peaks_1, {
        attribution: '<a href=""></a>',
        pane: 'pane_Peaks_1',
        onEachFeature: pop_Peaks_1,
        pointToLayer: function (feature, latlng) {
            var context = {
                feature: feature,
                variables: {}
            };
            return L.shapeMarker(latlng, style_Peaks_1_0(feature));
        },
    });
    bounds_group.addLayer(layer_Peaks_1);
    map.addLayer(layer_Peaks_1);

/*
END Peaks

BEGIN Rivers
*/


        function pop_ca_map_streams_streams_mshp2pct_0(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (i in e.target._eventParents) {
                        e.target._eventParents[i].resetStyle(e.target);
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Name'] !== null ? Autolinker.link(String(feature.properties['Name'])) : '') + '</td>\
                    </tr>\
                </table>';
            // layer.bindPopup(popupContent, {maxHeight: 400});
        }

        function style_ca_map_streams_streams_mshp2pct_0_0(feature) {
            if (feature.properties['len_km'] >= 19 && feature.properties['len_km'] <= 58 ) {
                return {
                pane: 'pane_ca_map_streams_streams_mshp2pct_0',
                opacity: 1,
                color: 'rgba(126,189,233,1)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: 0.6,
                fillOpacity: 0,
            }
            }
            if (feature.properties['len_km'] >= 58 && feature.properties['len_km'] <= 109 ) {
                return {
                pane: 'pane_ca_map_streams_streams_mshp2pct_0',
                opacity: 1,
                color: 'rgba(126,189,233,1)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: geoStyle(0.8),
                fillOpacity: 0,
            }
            }
            if (feature.properties['len_km'] >= 109 && feature.properties['len_km'] <= 168 ) {
                return {
                pane: 'pane_ca_map_streams_streams_mshp2pct_0',
                opacity: 1,
                color: 'rgba(126,189,233,1)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: geoStyle(1),
                fillOpacity: 0,
            }
            }
            if (feature.properties['len_km'] >= 168 && feature.properties['len_km'] <= 292 ) {
                return {
                pane: 'pane_ca_map_streams_streams_mshp2pct_0',
                opacity: 1,
                color: 'rgba(126,189,233,1)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: geoStyle(1.2),
                fillOpacity: 0,
            }
            }
            if (feature.properties['len_km'] >= 292 && feature.properties['len_km'] <= 565 ) {
                return {
                pane: 'pane_ca_map_streams_streams_mshp2pct_0',
                opacity: 1,
                color: 'rgba(126,189,233,1)',
                dashArray: '',
                lineCap: 'round',
                lineJoin: 'round',
                weight: geoStyle(1.4),
                fillOpacity: 0,
            }
            }
        }

        map.createPane('pane_ca_map_streams_streams_mshp2pct_0');
        map.getPane('pane_ca_map_streams_streams_mshp2pct_0').style.zIndex = 402;
        map.getPane('pane_ca_map_streams_streams_mshp2pct_0').style['mix-blend-mode'] = 'normal';
        var layer_ca_map_streams_streams_mshp2pct_0 = new L.geoJson(json_ca_map_streams_streams_mshp2pct_0, {
            attribution: '<a href=""></a>',
            pane: 'pane_ca_map_streams_streams_mshp2pct_0',
            onEachFeature: pop_ca_map_streams_streams_mshp2pct_0,
            style: style_ca_map_streams_streams_mshp2pct_0_0,
        });
        bounds_group.addLayer(layer_ca_map_streams_streams_mshp2pct_0);
        map.addLayer(layer_ca_map_streams_streams_mshp2pct_0);


/*
END Rivers
BEGIN Lakes
*/

        function pop_osm_calif_water_40hec_mshp5pctcopy_1(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (i in e.target._eventParents) {
                        e.target._eventParents[i].resetStyle(e.target);
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['name'] !== null ? Autolinker.link(String(feature.properties['name'])) : '') + '</td>\
                    </tr>\
                </table>';
            layer.bindPopup(popupContent, {maxHeight: 400});
        }

        var pattern_osm_calif_water_40hec_mshp5pctcopy_1_0 = new L.StripePattern({
            weight: 0.3,
            spaceWeight: 2.0,
            color: '#000000',
            opacity: 0.5,
            spaceOpacity: 0,
            angle: 315
        });

        pattern_osm_calif_water_40hec_mshp5pctcopy_1_0.addTo(map);

        function style_osm_calif_water_40hec_mshp5pctcopy_1_0(feature) {
            switch(String(feature.properties['natural'])) {
                case 'bay':
                    return {
                pane: 'pane_osm_calif_water_40hec_mshp5pctcopy_1',
                opacity: 1,
                color: 'rgba(152,215,237,1)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(234,179,58,1)',
            }
                    break;
                case 'glacier':
                    return {
                pane: 'pane_osm_calif_water_40hec_mshp5pctcopy_1',
                opacity: 1,
                color: 'rgba(152,215,237,1)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,255,255,1)',
            }
                    break;
                case 'marsh':
                    return {
                pane: 'pane_osm_calif_water_40hec_mshp5pctcopy_1',
                opacity: 1,
                color: 'rgba(152,215,237,1)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(22,212,98,1)',
            }
                    break;
                case 'river':
                    return {
                pane: 'pane_osm_calif_water_40hec_mshp5pctcopy_1',
                opacity: 1,
                color: 'rgba(152,215,237,1)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(19,179,237,1)',
            }
                    break;
                case 'water':
                    return {
                pane: 'pane_osm_calif_water_40hec_mshp5pctcopy_1',
                opacity: 1,
                color: 'rgba(126,189,233,1)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(183,224,237,1)',
            }
                    break;
                case 'wetland':
                    return {
                pane: 'pane_osm_calif_water_40hec_mshp5pctcopy_1',
                stroke: false,
                fillOpacity: 1,
                fillPattern: pattern_osm_calif_water_40hec_mshp5pctcopy_1_0
            }
                    break;
                default:
                    return {
                pane: 'pane_osm_calif_water_40hec_mshp5pctcopy_1',
                opacity: 1,
                color: 'rgba(152,215,237,1)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(233,36,72,1)',
            }
                    break;
                case 'dry':
                    return {
                pane: 'pane_osm_calif_water_40hec_mshp5pctcopy_1',
                opacity: 1,
                color: 'rgba(152,215,237,1)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(183,224,237,0.2)',
            }
                    break;
            }
        }
        map.createPane('pane_osm_calif_water_40hec_mshp5pctcopy_1');
        map.getPane('pane_osm_calif_water_40hec_mshp5pctcopy_1').style.zIndex = 403;
        map.getPane('pane_osm_calif_water_40hec_mshp5pctcopy_1').style['mix-blend-mode'] = 'normal';
        var layer_osm_calif_water_40hec_mshp5pctcopy_1 = new L.geoJson(json_osm_calif_water_40hec_mshp5pctcopy_1, {
            attribution: '<a href=""></a>',
            pane: 'pane_osm_calif_water_40hec_mshp5pctcopy_1',
            onEachFeature: pop_osm_calif_water_40hec_mshp5pctcopy_1,
            style: style_osm_calif_water_40hec_mshp5pctcopy_1_0,
        });
        bounds_group.addLayer(layer_osm_calif_water_40hec_mshp5pctcopy_1);
        map.addLayer(layer_osm_calif_water_40hec_mshp5pctcopy_1);
/*
END Lakes
*/



    var osmGeocoder = new L.Control.OSMGeocoder({
        collapsed: false,
        position: 'topright',
        text: 'Search',
    });
    osmGeocoder.addTo(map);


    // https://a.tiles.mapbox.com/v4/mapbox.light/8/41/97.png?access_token=pk.eyJ1Ijoiamhua2xseSIsImEiOiIxLUVDMzVNIn0.MguPdmGTQUvosyLINY3wGQ
    // var baselayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    // var baselayer = L.tileLayer('https://{s}.tiles.mapbox.com/v4/mapbox.mapbox-terrain-v2/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoiamhua2xseSIsImEiOiIxLUVDMzVNIn0.MguPdmGTQUvosyLINY3wGQ', {

    var mapboxLight = L.tileLayer('https://{s}.tiles.mapbox.com/v4/mapbox.light/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoiamhua2xseSIsImEiOiIxLUVDMzVNIn0.MguPdmGTQUvosyLINY3wGQ', {
        maxZoom: 28,
        attribution: 'Map data &copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    var osmMapnik = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 28,
        attribution: 'Map data &copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    });

    var thunderOutdoors = L.tileLayer('https://tile.thunderforest.com/outdoors/{z}/{x}/{y}.png?apikey=36ff718905b84b6995cf4df8cdf86e6f', {
        maxZoom: 28,
        attribution: 'Map data &copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    });

    var satellite = L.tileLayer('https://{s}.tiles.mapbox.com/v4/digitalglobe.nal0g75k/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZGlnaXRhbGdsb2JlIiwiYSI6ImNpdjhqc2VoMTAwYTYydHM5NWl2dndnZm4ifQ.zS3tz6K9ck2VLQlKoA2ryg', {
        maxZoom: 28,
        attribution: 'Map data &copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    });
// DG's mb key? https://api.tiles.mapbox.com/v4/digitalglobe.nal0g75k/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZGlnaXRhbGdsb2JlIiwiYSI6ImNpdjhqc2VoMTAwYTYydHM5NWl2dndnZm4ifQ.zS3tz6K9ck2VLQlKoA2ryg


var baseMaps = {
    "Light": mapboxLight,
    "Outdoors": thunderOutdoors,
    "OSM": osmMapnik,
    "Satellite": satellite,
};


    // var baseMaps = {};
    L.control.layers(
        baseMaps,
        {
            '<img src="legend/Peaks_1.png" /> Peaks': layer_Peaks_1,
            '<img src="legend/Peaks_1.png" /> Neighborhoods (SF)': layer_sf_hoods,
            '<img src="legend/Countylabels_0.png" /> County labels': layer_Countylabels_0,
        }
    ).addTo(map);

    setBounds();

    /*
    */
    var i = 0;
    layer_Countylabels_0.eachLayer(function(layer) {
        var context = {
            feature: layer.feature,
            variables: {}
        };
        layer.bindTooltip(
            (layer.feature.properties['label'] !== null?String('<div style="color: #7f7777; font-size: 8pt; font-family: \'Myriad Set Pro\', sans-serif; text-shadow: 0px 0px 1px rgba(255,255,255,1.0); ">' + layer.feature.properties['label']) + '</div>':''),
            // text-shadow: x y blur color;
            {
                permanent: true,
                direction: "center",
                offset: [-0, -0],
                className: 'css_Countylabels_0'
            }
        );
        labels.push(layer);
        totalMarkers += 1;
          layer.added = true;
          addLabel(layer, i);
          i++;
    });

    var i = 0;
    layer_Peaks_1.eachLayer(function(layer) {
        var context = {
            feature: layer.feature,
            variables: {}
        };
        layer.bindTooltip(
            // (label_Peaks_1_eval_expression(context) !== null ? \
            (layer.feature.properties['Name'] !== null ? String('<div style="text-align: center; color: #999; font-size: 10px; font-style: italic; font-family: \'Myriad Set Pro\', sans-serif;">' + label_Peaks_1_eval_expression(context)) + '</div>' : ''),
            {
                permanent: true, offset: [-2, -1], className: 'css_Peaks_1'
            });
        labels.push(layer);
        totalMarkers += 1;
      layer.added = true;
      addLabel(layer, i);
      i++;
    });

    var i = 0;
    layer_sf_hoods.eachLayer(function(layer) {
        var context = {
            feature: layer.feature,
            variables: {}
        };
        layer.bindTooltip(
            // (layer.feature.properties['name'] !== null ? String('<div style="text-align: center; color: rgb(220, 108, 20); font-size: 12px; font-style: bold; font-family: \'Myriad Set Pro\', sans-serif;">' + layer.feature.properties["name"]) + '</div>' : ''),
            (layer.feature.properties['name'] !== null ? String('<div class="label-parent"><div>' + layer.feature.properties["name"]) + '</div></div>' : ''),
            {
                permanent: true,
                // offset: [-40, 0],
                // offset: ["-50%", 0],
                className: 'sf_hoods_labels'
            });
        labels.push(layer);
        totalMarkers += 1;
      layer.added = true;
      addLabel(layer, i);
      i++;
    });

    var i = 0;
    layer_osm_calif_water_40hec_mshp5pctcopy_1.eachLayer(function(layer) {
        var context = {
            feature: layer.feature,
            variables: {}
        };
        layer.bindTooltip(
            // (label_Peaks_1_eval_expression(context) !== null ? \
            (layer.feature.properties['name'] !== null ? String('<div style="text-align: center; color: #999; font-size: 10px; font-style: italic; font-family: \'Myriad Set Pro\', sans-serif;">' + layer.feature.properties["name"]) + '</div>' : ''),
            {
                permanent: true, offset: [-2, -1], className: 'css_lakes'
            });
        labels.push(layer);
        totalMarkers += 1;
      layer.added = true;
      addLabel(layer, i);
      i++;
    });

    newM2px();

    layer_Peaks_1.setStyle(style_Peaks_1_0);
    layer_sf_hoods.setStyle(style_Peaks_1_0);

    map.on("zoomend", function(){
        newM2px();
        layer_Peaks_1.setStyle(style_Peaks_1_0);
        layer_sf_hoods.setStyle(style_Peaks_1_0);
    });

    var labelLayers = [
      layer_Countylabels_0,
      layer_Peaks_1,
      layer_sf_hoods,
      layer_osm_calif_water_40hec_mshp5pctcopy_1
    ];

    resetLabels(labelLayers);

    map.on("zoomend", function(){
        resetLabels(labelLayers);
    });

    map.on("layeradd", function(){
        resetLabels(labelLayers);
    });

    map.on("layerremove", function(){
        resetLabels(labelLayers);
    });

    </script>
</body>
</html>
